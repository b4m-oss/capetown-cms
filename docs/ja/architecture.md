# Capetown CMS アーキテクチャ

**Capetown** は、次世代のウェブ開発のニーズを満たすために設計された、現代的でモジュール式のCMSです。柔軟性と拡張性を念頭に置いて構築されており、開発者がコア機能を直接変更することなくカスタマイズできる強力なオーバーライドシステムを提供します。Capetownは、WordPressデータとの互換性を確保するように開発されており、プラットフォーム間のシームレスな移行と相互作用を可能にします。

[READ ME](../../README-ja.md) も参照してください。

## 概要

Capetown CMSは、以下を提供することでコンテンツ管理を再定義することを目指しています：

- **未来対応のアーキテクチャ**: Laravelの上に構築されており、モジュール式のアーキテクチャを活用して、開発者がカスタム機能を維持しながらコアシステムを更新できるようにします。
- **WordPressデータ互換性**: Capetownは、WordPressのデータ構造との互換性をサポートするように開発されており、開発者がWordPressからの移行や統合をシームレスに行えるようにします。
- **カスタマイズ可能で拡張可能**: カスタマイズに重点を置いており、コアコントローラー、ビュー、設定を簡単にオーバーライドできます。
- **モジュール設計**: Capetownは、テーマやプラグインを含むすべてのコンポーネントがモジュール式であり、コア機能に影響を与えることなく簡単に置き換えたり拡張したりできるという考えに基づいて構築されています。

## 機能

### コア機能
- **オーバーライド可能なコントローラーとビュー**: Laravelのコアを変更することなく、コアのロジックとプレゼンテーションをカスタマイズまたは置き換えます。
- **モジュール式テーマ管理**: ユーザー定義のテーマがデフォルトのテーマをオーバーライドする、クリーンで整理された方法でテーマを管理します。
- **プラグインシステム**: WordPressのフックとフィルターに触発され、柔軟なプラグインベースのカスタマイズを提供することを目指しています。
- **SEOカスタマイズ**: 現代の検索エンジンに最適化されたSEOメタデータ管理のための組み込みサポート。
- **フォームシステム**: カスタムフォームを簡単に作成し、データベースに送信を保存し、管理者にメールで送信して迅速にレビューできるようにします。

### 将来の機能
- **フックとフィルター**: WordPressの強力なフックに似た、Capetownの機能を拡張するための本格的なシステム。
- **マルチサイトサポート**: 1つのCapetownインスタンスから複数のウェブサイトやドメインをシームレスに管理します。
- **カスタム投稿タイプ**: 構造化されたコンテンツのための柔軟なカスタム投稿タイプ管理（計画中）。
- **WordPressインポート**: WordPressデータのインポートをサポートし、移行を簡単にします。

## ライセンス

Capetown CMSはオープンソースプロジェクトであり、[MITライセンス](../LICENSE)の下でリリースされています。ウェブ開発のための強力で現代的なソリューションにこのCMSを形作るための貢献とフィードバックを歓迎します。

# Capetown CMS - アーキテクチャ概要

Capetown CMSは、開発者に柔軟性を提供しながら、Laravelに強固な基盤を持つモジュール式で拡張可能なアーキテクチャで設計されています。このドキュメントは、モジュールコンポーネントを使用した拡張性とカスタマイズ性に焦点を当て、Capetown CMSのコアコンセプトと構造的組織を概説しています。

## コア原則

1. **モジュール性**: Capetownのすべての機能は、テーマからプラグイン、コア機能に至るまでモジュール式です。これにより、開発者はシステム全体の整合性に影響を与えることなく、特定のコンポーネントを拡張またはオーバーライドできます。

2. **オーバーライドメカニズム**: Capetownは、コントローラー、ビュー、設定ファイルのための強力なオーバーライドシステムを提供します。このシステムは、コアフレームワークが手つかずのままであることを保証しながら、その上にカスタム機能を構築できるようにします。

3. **WordPressデータとの互換性**: Capetownは、WordPressのデータ構造との互換性を維持することを目標に開発されており、既存のWordPressユーザーにとって簡単な移行と統合を可能にします。

## 高レベルアーキテクチャ

### 1. コア構造
Capetown CMSのコアは、Laravelフレームワークの上に構築されており、コア機能をオーバーライドするためのカスタム拡張が含まれています。主要なコンポーネントには以下が含まれます：

- **コントローラー**: HTTPリクエストを処理する責任があります。これらは、`app/Http/Controllers`ディレクトリにあるユーザー定義のコントローラーによってオーバーライドできます。
- **モデル**: データのやり取りは、LaravelのEloquent ORMを通じて処理され、データベース管理のための強力な抽象化を提供します。
- **ビュー**: HTMLをレンダリングするためにBladeテンプレートが使用され、テーマ内のユーザー定義のビューがデフォルトのビューをオーバーライドできます。

### 2. オーバーライドシステム
Capetownのオーバーライドシステムは、ユーザーがコントローラー、ビュー、設定をカスタマイズできるようにします。オーバーライドメカニズムは、層状のアプローチに従います：

1. **Laravelコア**: ベースシステムは手つかずのままであり、`vendor`ディレクトリにあります。
2. **Capetownコア**: Capetownによって提供される拡張とカスタマイズは、`capetown/`ディレクトリにあります。これらはLaravelフレームワークへの拡張として意図されています。
3. **ユーザーオーバーライド**: Capetownのコアロジックをオーバーライドするユーザー定義のコンポーネントは、`app/`ディレクトリにあります。

たとえば、ユーザーがコアコントローラーをオーバーライドしたい場合、新しいコントローラーを`app/Http/Controllers/`に定義するだけで、Capetownシステムは自動的にユーザーのバージョンをコアより優先します。

### 3. テーマ管理
Capetownは、クリーンで構造化されたテーマ管理システムを通じて、完全なテーマカスタマイズをサポートします。

### 4. プラグインシステム（計画中）
Capetownは、WordPressのフックとフィルターに触発されたプラグインシステムを導入し、開発者がコアコードに触れることなく機能を追加または変更できるようにします。このシステムには以下が含まれます：

- **アクション**: システム内の特定のポイントで追加の機能を注入することを開発者に許可します。
- **フィルター**: データがレンダリングまたは処理される前に変更を可能にします。

## 設定管理

Capetownは、設定管理のためにハイブリッドアプローチを使用します。ほとんどの設定ファイルは`config/`ディレクトリにありますが、特定の設定はデータベースに保存され、動的に更新されることがあります。

## 将来の機能とアーキテクチャ

Capetown CMSは、将来を見据えて設計されています。以下は、将来のリリースで計画されている主要な機能とそのアーキテクチャ的な影響です：

### 1. フックとフィルター（計画中）
Capetownは、WordPressに似たフックとフィルターのシステムを実装し、開発者がコアコードを直接変更することなくシステムの動作を拡張または変更できるようにします。

- **フック**: 実行中の特定のポイントでカスタムコードを実行する方法を提供します（例：投稿を保存する際）。
- **フィルター**: データの変更を許可します（例：表示される前に投稿内容を変更）。

### 2. マルチサイトサポート（計画中）
Capetownは、管理者が単一のCapetownインスタンスから複数のウェブサイトを管理できるマルチサイトインストールをサポートします。各サイトは、そのドメインまたはサブドメインによって区別されます。

- **アーキテクチャ**: マルチサイトサポートは、Laravelのルーティングとデータベースシステムを拡張することを含みます。各サイトは独自の設定、テーマ、おそらくユニークなデータベーステーブルを持ちます。
- **ユーザー管理**: 管理者は、異なるサイト間でユーザーの役割と権限を管理する能力を持ちます。

### 3. カスタム投稿タイプ（計画中）
Capetownは、標準のブログ投稿に加えて、構造化されたコンテンツ（例：ポートフォリオ、推薦文）を作成する柔軟性をユーザーに提供するカスタム投稿タイプを導入します。

- **アーキテクチャ**: カスタム投稿タイプは、設定ファイルまたは管理パネルを通じて管理され、専用のデータベーステーブルに保存され、フィールド、分類法、関係の完全なカスタマイズを可能にします。

## ディレクトリ構造

以下は、典型的なCapetownインストールの予想されるディレクトリ構造の例です：

**これは検討中です。最終決定ではありません！**

```
/root-dir/
├─ /app # ユーザーが自由にカスタマイズおよびオーバーライドできるエリア
│  ├─ /themes
│  │  ├─ /default_theme       # 同じ名前のテーマが存在する場合、コアテーマをオーバーライドします
│  │  └─ /user_theme       # もちろん、ユーザーは独自のテーマを自由に作成できます。
│  └─ /plugins       # プラグインは、Capetown CMSの標準機能を超えた追加機能を提供します。
│     ├─ /plugin-a
│     └─ /plugin-made-by-user
├─ /core # ユーザーはこのエリア以下のファイルを更新または削除してはなりません。
│  ├─ /capetown       # Capetown CMSのコア機能。このアプリの新しいバージョンは、新しいバージョン番号でこのディレクトリにインストールされます。
│  │  └─ /capetown-0.2.0
│  │     ├─ /themes
│  │     │  └─ /default_theme
│  │     └─ /plugins
│  └─ /laravel       # Capetownの基盤であるLaravelコアパッケージ。新しいバージョンのlaravelは、新しいバージョン番号でこのディレクトリにインストールされます。
│     ├─ /laravel-11.0.2
│     └─ /laravel-12.0.0
├─ /media       # ユーザーがアップロードしたバイナリファイルは、他のファイル名やファイルパスを推測しにくくするために、3レベルのランダムな名前のディレクトリに自動的に保存されます。
│  └─ /1012
│     └─ /2093
│        └─ /8977
│           └─ /user-uploaded.png
├─ /cache
└─ /config
   └─ /capetown.php       # Capetown CMSの設定ファイル。

```

### 主要ディレクトリ：
- **app/**: コントローラーとサービスプロバイダーのためのユーザー定義のオーバーライドを含みます。
- **capetown/**: デフォルトのコントローラー、将来のプラグインシステム、その他のコアコンポーネントを含むCapetown CMSのコアロジック。
- **config/**: Capetownの設定ファイル、グローバル設定やテーマ関連の設定を含みます。
- **resources/views/**: テーマとビューのテンプレートを保存し、ユーザー定義のテーマオーバーライドを可能にします。
- **database/migrations/**: コアテーブルと将来のプラグイン統合のためのデータベースマイグレーションを処理します。

## 結論

Capetown CMSは、開発者に柔軟でモジュール式のシステムを提供し、簡単に拡張、カスタマイズ、維持できるように設計されています。強力なオーバーライドシステム、将来のマルチサイトサポート、WordPressデータ互換性などの機能を備えたCapetownは、現代のウェブ開発のための強力なツールを目指しています。
